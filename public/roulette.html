<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Black Jack</title>
        <link rel="stylesheet" href="blackjack.css">
        <script src="blackjack.js"></script>
        <style>
            /* Home Button Style */
            .home-button {
                position: absolute;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                font-size: 1em;
                background-color: white;
                color: black;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                z-index: 5; /* Ensure button is on top */
            }

            .home-button:hover {
                background-color: grey;
            }

            /* Flexbox styling for centered content */
            body {
                font-family: Arial, Helvetica, sans-serif;
                color: white;
                background-color: black;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                height: 100vh;
                margin: 0;
                position: relative;
                overflow: hidden;
            }

            /* Canvas for rain effect */
            canvas {
                position: absolute;
                top: 0;
                left: 0;
                z-index: 2; /* Rain goes behind cards */
                pointer-events: none; /* Prevent interaction */
            }

            /* Content that goes on top of the rain */
            #content {
                z-index: 3; /* Content on top of rain */
                text-align: center;
                margin-top: 40px;
            }

            /* Buttons styling */
            button {
                margin: 10px;
                padding: 10px 20px;
                font-size: 20px;
                cursor: pointer;
            }

            /* Card images adjustment */
            #dealer-cards img, #your-cards img {
                height: 175px;
                width: 125px;
                margin: 5px;
            }

            /* Play Again Button Style */
            #play-again {
                display: none; /* Hidden by default */
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 15px 30px;
                font-size: 30px;
                cursor: pointer;
                z-index: 5; /* Ensure button appears on top */
                background-color: green; /* Ensure visibility */
                color: white;
                border: none;
                border-radius: 5px;
            }
        </style>
    </head>

    <body>
        <!-- Home Button to go back to the index.html -->
        <button class="home-button" onclick="window.location.href='index.html'">Home</button>

        <!-- Blackjack Content -->
        <div id="content">
            <h2>Dealer: <span id="dealer-sum"></span></h2>
            <div id="dealer-cards">
                <img id="hidden" src="./cards/BACK.png">
            </div>

            <h2>You: <span id="your-sum"></span></h2>
            <div id="your-cards"></div>

            <br>
            <button id="hit">Hit</button>
            <button id="stay">Stay</button>
            <p id="results"></p>
        </div>

        <!-- Rainy Background Effect Canvas -->
        <canvas id="canvas"></canvas>

        <!-- Play Again Button -->
        <button id="play-again">Play Again</button>

        <script>
            // Blackjack game logic and button functionality
            let dealerSum = 0;
            let yourSum = 0;

            let dealerAceCount = 0;
            let yourAceCount = 0;

            let hidden;
            let deck;

            let canHit = true; // allows the player (you) to draw while yourSum <= 21

            window.onload = function() {
                buildDeck();
                shuffleDeck();
                startGame();
                setupPlayAgainButton(); // Set up Play Again button on page load
            }

            function buildDeck() {
                let values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
                let types = ["C", "D", "H", "S"];
                deck = [];

                for (let i = 0; i < types.length; i++) {
                    for (let j = 0; j < values.length; j++) {
                        deck.push(values[j] + "-" + types[i]); // A-C -> K-C, A-D -> K-D
                    }
                }
            }

            function shuffleDeck() {
                for (let i = 0; i < deck.length; i++) {
                    let j = Math.floor(Math.random() * deck.length);
                    let temp = deck[i];
                    deck[i] = deck[j];
                    deck[j] = temp;
                }
            }

            function startGame() {
                hidden = deck.pop();
                dealerSum += getValue(hidden);
                dealerAceCount += checkAce(hidden);

                while (dealerSum < 17) {
                    let cardImg = document.createElement("img");
                    let card = deck.pop();
                    cardImg.src = "./cards/" + card + ".png";
                    dealerSum += getValue(card);
                    dealerAceCount += checkAce(card);
                    document.getElementById("dealer-cards").append(cardImg);
                }

                for (let i = 0; i < 2; i++) {
                    let cardImg = document.createElement("img");
                    let card = deck.pop();
                    cardImg.src = "./cards/" + card + ".png";
                    yourSum += getValue(card);
                    yourAceCount += checkAce(card);
                    document.getElementById("your-cards").append(cardImg);
                }

                document.getElementById("hit").addEventListener("click", hit);
                document.getElementById("stay").addEventListener("click", stay);
            }

            function hit() {
                if (!canHit) {
                    return;
                }

                let cardImg = document.createElement("img");
                let card = deck.pop();
                cardImg.src = "./cards/" + card + ".png";
                yourSum += getValue(card);
                yourAceCount += checkAce(card);
                document.getElementById("your-cards").append(cardImg);

                if (reduceAce(yourSum, yourAceCount) > 21) {
                    canHit = false;
                }
            }

            function stay() {
                dealerSum = reduceAce(dealerSum, dealerAceCount);
                yourSum = reduceAce(yourSum, yourAceCount);

                canHit = false;
                document.getElementById("hidden").src = "./cards/" + hidden + ".png";

                let message = "";
                if (yourSum > 21) {
                    message = "You Lose!";
                } else if (dealerSum > 21) {
                    message = "You Win!";
                } else if (yourSum === dealerSum) {
                    message = "Tie!";
                } else if (yourSum > dealerSum) {
                    message = "You Win!";
                } else {
                    message = "You Lose!";
                }

                document.getElementById("dealer-sum").innerText = dealerSum;
                document.getElementById("your-sum").innerText = yourSum;
                document.getElementById("results").innerText = message;

                // Show the Play Again button after 1 second
                setTimeout(() => {
                    document.getElementById("play-again").style.display = "block";
                }, 1000);
            }

            function getValue(card) {
                let data = card.split("-");
                let value = data[0];

                if (isNaN(value)) { // A, J, Q, K
                    if (value === "A") {
                        return 11;
                    }
                    return 10;
                }
                return parseInt(value);
            }

            function checkAce(card) {
                if (card[0] === "A") {
                    return 1;
                }
                return 0;
            }

            function reduceAce(playerSum, playerAceCount) {
                while (playerSum > 21 && playerAceCount > 0) {
                    playerSum -= 10;
                    playerAceCount -= 1;
                }
                return playerSum;
            }

            // Setup the Play Again button
            function setupPlayAgainButton() {
                let playAgainBtn = document.getElementById("play-again");
                
                // Make the button bigger
                playAgainBtn.style.fontSize = "30px";
                playAgainBtn.style.padding = "15px 30px";
                playAgainBtn.style.backgroundColor = "green"; // Change button color
                playAgainBtn.style.color = "white";

                // Add event listener to reload the page
                playAgainBtn.addEventListener("click", () => {
                    window.location.reload(); // Reload the page to start a new game
                });

                // Hide it initially
                playAgainBtn.style.display = "none";
            }
        </script>
    </body>
</html>
