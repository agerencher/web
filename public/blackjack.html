<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Blackjack</title>
        <link rel="stylesheet" href="blackjack.css">
        <script src="blackjack.js"></script>
        <style>
            /* Home Button Style */
            .home-button {
                position: absolute;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                font-size: 1em;
                background-color: white;
                color: black;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                z-index: 5; /* Ensure button is on top */
            }

            .home-button:hover {
                background-color: grey;
            }

            /* Flexbox styling for centered content */
            body {
                font-family: Arial, Helvetica, sans-serif;
                color: white;
                background-color: black;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                height: 100vh;
                margin: 0;
                position: relative;
                overflow: hidden;
            }

            /* Canvas for rain effect */
            canvas {
                position: absolute;
                top: 0;
                left: 0;
                z-index: 2; /* Rain goes behind cards */
                pointer-events: none; /* Prevent interaction */
            }

            /* Content that goes on top of the rain */
            #content {
                z-index: 3; /* Content on top of rain */
                text-align: center;
                margin-top: 40px;
            }

            /* Buttons styling */
            button {
                margin: 10px;
                padding: 10px 20px;
                font-size: 20px;
                cursor: pointer;
            }

            /* Card images adjustment */
            #dealer-cards img, #your-cards img {
                height: 175px;
                width: 125px;
                margin: 5px;
            }

            /* Play Again Button Style */
            #play-again {
                display: none; /* Hidden by default */
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 15px 30px;
                font-size: 30px;
                cursor: pointer;
                z-index: 5; /* Ensure button appears on top */
                background-color: green; /* Ensure visibility */
                color: white;
                border: none;
                border-radius: 5px;
            }

            /* Confetti Styles */
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                background-color: red;
                opacity: 0.7;
                z-index: 4;
                border-radius: 50%;
                animation: confettiFall 3s linear infinite;
            }

            @keyframes confettiFall {
                0% {
                    transform: translateY(0) rotate(0deg);
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                }
            }
        </style>
    </head>

    <body>
        <!-- Home Button to go back to the index.html -->
        <button class="home-button" onclick="window.location.href='index.html'">Home</button>

        <!-- Blackjack Content -->
        <div id="content">
            <h2>Dealer: <span id="dealer-sum"></span></h2>
            <div id="dealer-cards">
                <img id="hidden" src="./cards/BACK.png">
            </div>

            <h2>You: <span id="your-sum"></span></h2>
            <div id="your-cards"></div>

            <br>
            <button id="hit">Hit</button>
            <button id="stay">Stay</button>
            <p id="results"></p>
        </div>

        <!-- Rainy Background Effect Canvas -->
        <canvas id="canvas"></canvas>

        <!-- Play Again Button -->
        <button id="play-again">Play Again</button>

        <script>
            window.onload = function () {
                // Start the Blackjack game
                buildDeck();
                shuffleDeck();
                startGame();

                // Rain effect code
                let canvas = document.getElementById("canvas");
                let c = canvas.getContext("2d");
                let w = (canvas.width = window.innerWidth);
                let h = (canvas.height = window.innerHeight);

                let raindrops = [];
                let numRaindrops = 200;
                let rainDirection = 0;
                let rainColor = "#d3d3d3";

                class Raindrop {
                    constructor() {
                        this.x = Math.random() * w;
                        this.y = Math.random() * h;
                        this.length = Math.random() * 20 + 10;
                        this.speed = Math.random() * 2 + 1;
                    }

                    update() {
                        if (rainDirection === 0) {
                            this.y += this.speed;
                            if (this.y > h) this.y = -this.length;
                        } else if (rainDirection === 1) {
                            this.x += this.speed;
                            if (this.x > w) this.x = -this.length;
                        } else if (rainDirection === 2) {
                            this.y -= this.speed;
                            if (this.y < -this.length) this.y = h;
                        } else if (rainDirection === 3) {
                            this.x -= this.speed;
                            if (this.x < -this.length) this.x = w;
                        }
                    }

                    draw() {
                        c.beginPath();
                        if (rainDirection === 0 || rainDirection === 2) {
                            c.moveTo(this.x, this.y);
                            c.lineTo(this.x, this.y + this.length);
                        } else {
                            c.moveTo(this.x, this.y);
                            c.lineTo(this.x + this.length, this.y);
                        }
                        c.strokeStyle = rainColor;
                        c.lineWidth = 1;
                        c.stroke();
                    }
                }

                for (let i = 0; i < numRaindrops; i++) {
                    raindrops.push(new Raindrop());
                }

                function draw() {
                    c.clearRect(0, 0, w, h);

                    raindrops.forEach(raindrop => {
                        raindrop.update();
                        raindrop.draw();
                    });
                }

                function loop() {
                    draw();
                    requestAnimationFrame(loop);
                }

                window.addEventListener("resize", function () {
                    w = canvas.width = window.innerWidth;
                    h = canvas.height = window.innerHeight;
                    loop();
                });

                loop();

                // Setup Play Again button to reload the page
                document.getElementById('play-again').addEventListener('click', function () {
                    window.location.reload(); // Reload the page
                });
            };

            // Function to create and animate confetti
            function createConfetti() {
                const confettiColors = ["#FF0A54", "#FF477E", "#FF5C8A", "#FF85A1", "#FFA3B5", "#FFC2D1"];
                for (let i = 0; i < 100; i++) {
                    let confetti = document.createElement("div");
                    confetti.classList.add("confetti");
                    confetti.style.left = Math.random() * window.innerWidth + "px";
                    confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 1) + "s";
                    document.body.appendChild(confetti);
                    
                    // Remove confetti after falling
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }
            }

            function showResult(message) {
                document.getElementById("results").innerText = message;
                if (message === "You Win!") {
                    createConfetti(); // Trigger confetti on win
                }
            }
        </script>
    </body>
</html>
